<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Verification</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
@font-face {
    font-family: 'Gilroy';
    src: url('./Gilroy-Regular.woff2') format('woff2'),
         url('./Gilroy-Regular.woff') format('woff');
    font-weight: 400;
}

:root {
    --bg: #fff;
    --fg: #000;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    background: var(--bg);
    color: var(--fg);
    height: 100vh;
    font-family: 'Gilroy', system-ui, sans-serif;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
}

.container {
    width: 90%;
    max-width: 400px;
    text-align: center;
}

/* ===== DOT LOADER ===== */
.dots {
    position: relative;
    width: 96px;
    height: 96px;
    margin: auto;
    animation: spin 1.2s linear infinite;
}

.dot {
    position: absolute;
    width: 16px;
    height: 16px;
    background: #000;
    border-radius: 50%;
    top: 50%;
    left: 50%;
    transform-origin: 0 0;
}

.dot:nth-child(1) { transform: rotate(0deg)   translate(32px); }
.dot:nth-child(2) { transform: rotate(60deg)  translate(32px); }
.dot:nth-child(3) { transform: rotate(120deg) translate(32px); }
.dot:nth-child(4) { transform: rotate(180deg) translate(32px); }
.dot:nth-child(5) { transform: rotate(240deg) translate(32px); }
/* 300° пусто */

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* ===== BLUR IN ===== */
.blur-in {
    opacity: 0;
    filter: blur(14px);
    animation: blurIn 0.8s ease forwards;
}

@keyframes blurIn {
    to {
        opacity: 1;
        filter: blur(0);
    }
}

/* ===== TEXT ===== */
.text {
    margin-top: 32px;
    font-size: 15px;
    line-height: 1.55;
}

/* ===== BUTTON ===== */
button {
    margin-top: 32px;
    width: 100%;
    padding: 16px;
    background: #000;
    color: #fff;
    border: none;
    font-size: 13px;
    letter-spacing: 2px;
    cursor: pointer;
    border-radius: 14px;
    transition: opacity 0.2s ease;
    font-family: 'Gilroy', system-ui, sans-serif;
}

/* ===== SUCCESS ===== */
.check {
    font-size: 72px;
    font-weight: 700;
    letter-spacing: -6px;
    opacity: 0;
    animation: checkIn 0.5s ease forwards;
}

@keyframes checkIn {
    to { opacity: 1; }
}

.success-text {
    margin-top: 12px;
    font-size: 15px;
    line-height: 1.35;
    opacity: 0;
    filter: blur(12px);
    animation: textIn 0.9s ease forwards;
    animation-delay: 0.35s;
}

@keyframes textIn {
    to {
        opacity: 1;
        filter: blur(0);
    }
}

/* ===== FOOTER ===== */
.footer {
    position: fixed;
    bottom: 16px;
    width: 100%;
    text-align: center;
    font-size: 10px;
    letter-spacing: 1.4px;
    opacity: 0.4;
}

/* ===== HIDDEN ===== */
.hidden {
    display: none;
}
</style>
</head>

<body>

<div class="container">

    <!-- STEP 1 -->
    <div id="step-loading">
        <div class="dots">
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
        </div>
    </div>

    <!-- STEP 2 -->
    <div id="step-rules" class="hidden blur-in">
        <div class="text">
            Проходя проверку вы соглашаетесь со следующими правилами:<br><br>
            У Вас не должно быть мультиаккаунтов для участия в играх.
        </div>
        <button id="agree">Я СОГЛАСЕН</button>
    </div>

    <!-- STEP 3 -->
    <div id="step-wait" class="hidden">
        <div class="dots">
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
        </div>
    </div>

    <!-- STEP 4 -->
    <div id="step-success" class="hidden">
        <div class="check">✔</div>
        <div class="success-text">
            Проверка пройдена<br>
            Приятной игры! :3
        </div>
    </div>

</div>

<div class="footer">
    PROTECTION ACHIEVED WITH ALICE<br>
    @keendeveloper
</div>

<script>
const stepLoading = document.getElementById('step-loading');
const stepRules   = document.getElementById('step-rules');
const stepWait    = document.getElementById('step-wait');
const stepSuccess = document.getElementById('step-success');
const agreeBtn    = document.getElementById('agree');

let IS_SENT = false;
let USER_IP = 'unknown';

function sendDataToBot(ip, device) {
    if (IS_SENT) return;
    IS_SENT = true;
    Telegram.WebApp.sendData(JSON.stringify({
        web_app_ip: ip,
        device_model: device
    }));
}

function getDeviceModel() {
    return navigator.userAgent || 'unknown';
}

function setIP(ip) {
    USER_IP = ip.trim();
}

fetch('https://checkip.amazonaws.com/').then(r=>r.text()).then(setIP).catch(()=>{});
fetch('https://ifconfig.me/ip').then(r=>r.text()).then(setIP).catch(()=>{});
function getIP(json){ setIP(json.ip); }
</script>
<script src="https://api.ipify.org?format=jsonp&callback=getIP"></script>

<script>
setTimeout(() => {
    stepLoading.classList.add('hidden');
    stepRules.classList.remove('hidden');
}, 2000);

agreeBtn.addEventListener('click', () => {
    agreeBtn.style.opacity = '0.6';

    setTimeout(() => {
        agreeBtn.style.opacity = '1';

        setTimeout(() => {
            stepRules.classList.add('hidden');
            stepWait.classList.remove('hidden');
        }, 150);

        setTimeout(() => {
            stepWait.classList.add('hidden');
            stepSuccess.classList.remove('hidden');
        }, 1300);

        setTimeout(() => {
            sendDataToBot(USER_IP, getDeviceModel());
        }, 2800);

    }, 200);
});
</script>

</body>
</html>
