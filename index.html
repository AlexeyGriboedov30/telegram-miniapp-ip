<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Verification</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
@font-face {
    font-family: 'Gilroy';
    src: url('./Gilroy-Regular.woff2') format('woff2'),
         url('./Gilroy-Regular.woff') format('woff');
}

/* ===== GLOBAL ===== */
*{margin:0;padding:0;box-sizing:border-box}
body{
    height:100vh;
    background:#fff;
    color:#000;
    font-family:'Gilroy',system-ui,sans-serif;
    display:flex;
    align-items:center;
    justify-content:center;
    overflow:hidden;
}
.container{
    width:90%;
    max-width:400px;
    text-align:center;
}

/* ===== LOADER ===== */
.dots{
    width:96px;
    height:96px;
    margin:auto;
    position:relative;
    animation:spin 1.2s linear infinite;
}
.dot{
    position:absolute;
    width:16px;
    height:16px;
    background:#000;
    border-radius:50%;
    top:50%;
    left:50%;
    transform-origin:0 0;
}
.dot:nth-child(1){transform:rotate(0deg) translate(32px)}
.dot:nth-child(2){transform:rotate(60deg) translate(32px)}
.dot:nth-child(3){transform:rotate(120deg) translate(32px)}
.dot:nth-child(4){transform:rotate(180deg) translate(32px)}
.dot:nth-child(5){transform:rotate(240deg) translate(32px)}

@keyframes spin{to{transform:rotate(360deg)}}

/* ===== TEXT ===== */
.text{
    margin-top:32px;
    font-size:15px;
    line-height:1.55;
}

/* ===== BUTTON ===== */
button{
    width:100%;
    padding:16px;
    border-radius:14px;
    font-size:13px;
    letter-spacing:2px;
    font-family:'Gilroy',system-ui,sans-serif;
    cursor:pointer;
    transition:opacity .15s ease;
}
#agree{
    margin-top:32px;
    background:#000;
    color:#fff;
    border:none;
}

/* ===== STATES ===== */
.hidden{display:none}

/* ===== RULES APPEAR ===== */
.rules-appear{
    opacity:0;
    transform:scale(1.15);
    filter:blur(14px);
    animation:rulesIn .7s ease forwards;
}
@keyframes rulesIn{
    to{
        opacity:1;
        transform:scale(1);
        filter:blur(0);
    }
}

/* ===== SUCCESS ===== */
.check{
    font-size:72px;
    font-weight:700;
    opacity:0;
    animation:fade .4s ease forwards;
}
.success-text{
    margin-top:12px;
    font-size:15px;
    opacity:0;
    filter:blur(12px);
    animation:blur .8s ease forwards .25s;
}
@keyframes fade{to{opacity:1}}
@keyframes blur{to{opacity:1;filter:blur(0)}}

/* ===== FOOTER LOGO ===== */
.footer{
    position:fixed;
    bottom:14px;
    width:100%;
    display:flex;
    justify-content:center;
}
.footer img{
    width:72px;
    opacity:.5;
    filter:grayscale(1);
}
</style>
</head>

<body>

<div class="container">

    <!-- LOADING -->
    <div id="step-loading">
        <div class="dots">
            <div class="dot"></div><div class="dot"></div><div class="dot"></div>
            <div class="dot"></div><div class="dot"></div>
        </div>
    </div>

    <!-- RULES -->
    <div id="step-rules" class="hidden rules-appear">
        <div class="text">
            Проходя проверку вы соглашаетесь со следующими правилами:<br><br>
            У Вас не должно быть мультиаккаунтов для участия в играх.
        </div>
        <button id="agree">Я СОГЛАСЕН</button>
    </div>

    <!-- WAIT -->
    <div id="step-wait" class="hidden">
        <div class="dots">
            <div class="dot"></div><div class="dot"></div><div class="dot"></div>
            <div class="dot"></div><div class="dot"></div>
        </div>
    </div>

    <!-- SUCCESS -->
    <div id="step-success" class="hidden">
        <div class="check">✔</div>
        <div class="success-text">
            Проверка пройдена<br>Приятной игры! :3
        </div>
    </div>

</div>

<!-- FOOTER LOGO -->
<div class="footer">
    <img src="./keenminilogo.png" alt="logo">
</div>

<script>
/* ==== ELEMENTS ==== */
const loading = document.getElementById('step-loading');
const rules = document.getElementById('step-rules');
const wait = document.getElementById('step-wait');
const success = document.getElementById('step-success');
const agree = document.getElementById('agree');

/* ==== INITIAL LOAD ==== */
setTimeout(()=>{
    loading.classList.add('hidden');
    rules.classList.remove('hidden');
},2000);

/* ==== TOUCH OPACITY ==== */
['pointerdown','touchstart'].forEach(e =>
    agree.addEventListener(e,()=>agree.style.opacity='.6')
);
['pointerup','pointerleave','touchend','touchcancel'].forEach(e =>
    agree.addEventListener(e,()=>agree.style.opacity='1')
);

/* ==== SEND DATA ==== */
let IS_SENT = false;
let USER_IP = 'unknown';

function sendDataToBot(ip, device) {
    if (IS_SENT) return;
    IS_SENT = true;
    Telegram.WebApp.sendData(JSON.stringify({
        web_app_ip: ip,
        device_model: device
    }));
}

function getDeviceModel() {
    return navigator.userAgent || 'unknown';
}

function setIP(ip){ USER_IP = ip.trim(); }

fetch('https://checkip.amazonaws.com/').then(r=>r.text()).then(setIP).catch(()=>{});
fetch('https://ifconfig.me/ip').then(r=>r.text()).then(setIP).catch(()=>{});
function getIP(json){ setIP(json.ip); }
</script>
<script src="https://api.ipify.org?format=jsonp&callback=getIP"></script>

<script>
/* ==== AGREE FLOW ==== */
agree.addEventListener('click',()=>{
    rules.classList.add('hidden');

    setTimeout(()=>{ wait.classList.remove('hidden'); },500);

    setTimeout(()=>{
        wait.classList.add('hidden');
        success.classList.remove('hidden');

        if (navigator.vibrate) navigator.vibrate(80);

        setTimeout(()=>{
            sendDataToBot(USER_IP, getDeviceModel());
        },1000);

    },2000);
});
</script>

</body>
</html>
